<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”×¢×•×–×¨×ª ×©×œ ××œ×§×¡×” - ×˜×™×™××¨ ×‘×™×©×•×œ ×—×›×</title>
    <meta name="description" content="×”×¢×•×–×¨×ª ×©×œ ××œ×§×¡×” - ×˜×™×™××¨ ×‘×™×©×•×œ ×—×›× ×”××•×©×œ×! ×¢× ×¡×¤×™×¨×” ×œ××—×•×¨ ××ª×•×§× ×ª, ×›×¤×ª×•×¨ ×”×ª×§× ×” ×‘×•×œ×˜ ×œ××¡×š ×”×‘×™×ª, ×”×ª×¨××•×ª ×§×•×œ×™×•×ª, ×•×”×§×œ×“×” ×™×“× ×™×ª.">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi15TXotW91aLXqNemINeo15wgXHUwMGZlXHUwMGY3XHUwMGZlIOKIkiDXmNecXHUwMGZlWNeZ157XqCDXkdeZ16nXldecINeX16rXnSIsInNob3J0X25hbWUiOiLXlNeu15LXqNeo15wgXHUwMGZlXHUwMGY3XHUwMGZlINeo15wgXHUwMGZlWDeZ16fXqdeUIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiNlYTU4MGMiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnZG1sbGQwSnZlRDBpTUNBd0lEVXhNaUExTVRJaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2VEMGlNVEF3SWlCNVBTSXhNREFpSUhkcFpIUm9QU0l6TVRJaUlHaGxhV2RvZEQwaU16RXlJaUJtYVd4c1BTSWpaR2RqYUNJZ2NuZzlJakU0SWk4K1BIUmxlSFFnZUQwaU1UWTJJaUI1UFNJeE56QWlJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMV1poYldsc2VUMGlRWEpwWVd3c0lITmhibk10YzJWeWFXWWlJR1p2Ym5RdGMybDZaVDBpTVRoZ2VDSStYeUF3TnpOalhpQmNkVUF3TUdabFhIVkJNREUyWDJSaFhIVkJNREUwSWx3dlBIUmxlSFFnZUQwaU1UWTJJaUI1UFNJNU1TNGlJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMV1poYldsc2VUMGlRWEpwWVd3c0lITmhibk10YzJWeWFXWWlJR1p2Ym5RdGMybDZaVDBpTVRoZ2VDSStYeUF3TnpOalgxdDBhaUJ2ZENBeFhpQmNkVUF3TUdabElGeDFRVEF4WVdSY2RVQXdNV2hqWDFsdFh5QmNkVUF3TVdGallpQmNkVUF3TVdkalpWNzBhbUZjSWw4dlBIUmxlSFFnZUQwaU1UWTJJaUI1UFNJeE5tVmZJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMV1poYldsc2VUMGlRWEpwWVd3c0lITmhibUV0YzJWeWFXWWlJR1p2Ym5RdGMybDZaVDBpTVRoZ2VDSStYeUF3TnpOalhubGNkVUF3TW1Ga1hIVkJNREZsYXlCY2RVQXdNV1JqWDFreFhpa2dJRnN0SWw4dlBDOXpkbWMrIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap');
        
        * {
            font-family: 'Assistant', 'Arial', sans-serif;
        }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .preset-button {
            background: linear-gradient(135deg, #ea580c, #f97316);
            transition: all 0.3s ease;
        }
        
        .preset-button:hover {
            background: linear-gradient(135deg, #f97316, #fb923c);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 146, 60, 0.4);
        }
        
        .control-button {
            transition: all 0.2s ease;
            min-height: 48px;
            min-width: 48px;
        }
        
        .control-button:hover {
            transform: scale(1.05);
        }
        
        .timer-running {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .modal-overlay {
            backdrop-filter: blur(5px);
        }
        
        .beep {
            animation: beep-flash 0.5s ease-in-out;
        }
        
        @keyframes beep-flash {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.2); }
        }
        
        .install-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            transition: all 0.3s ease;
            animation: install-bounce 3s infinite;
        }
        
        .install-button:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: scale(1.05);
        }
        
        @keyframes install-bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-3px);
            }
            60% {
                transform: translateY(-2px);
            }
        }
        
        .input-field {
            direction: ltr;
            text-align: center;
        }
        
        .stop-alarm-button {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            animation: alarm-pulse 1s infinite;
        }
        
        @keyframes alarm-pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-yellow-50 min-h-screen" dir="rtl">
    <!-- Install Button -->
    <div class="fixed top-4 left-4 z-50">
        <button id="installBtn" class="install-button text-white px-4 py-2 rounded-full shadow-lg text-sm font-semibold">
            <i class="fas fa-download mr-2"></i>
            ×”×ª×§×Ÿ ××¤×œ×™×§×¦×™×”
        </button>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-orange-800 mb-2">
                ğŸ¤– ×”×¢×•×–×¨×ª ×©×œ ××œ×§×¡×”
            </h1>
            <p class="text-orange-600 text-sm">×˜×™×™××¨ ×”×‘×™×©×•×œ - ×”×›×œ×™ ×”××•×©×œ× ×œ×›×œ ×‘×©×œ×Ÿ</p>
        </div>

        <!-- Timer Display -->
        <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 border-4 border-orange-200">
            <div class="text-center">
                <div id="timerDisplay" class="timer-display text-orange-800 mb-4">00:00</div>
                
                <!-- Time Input Section -->
                <div class="flex justify-center items-center space-x-4 mb-4" dir="ltr">
                    <!-- Minutes Section -->
                    <div class="text-center">
                        <input type="number" id="minutesInput" class="input-field w-20 h-12 text-2xl font-bold border-2 border-orange-300 rounded-lg text-orange-800" 
                               value="0" min="0" max="99" placeholder="0">
                        <div class="text-orange-600 text-sm mt-1">×“×§×•×ª</div>
                    </div>
                    
                    <div class="text-3xl font-bold text-orange-400">:</div>
                    
                    <!-- Seconds Section -->
                    <div class="text-center">
                        <input type="number" id="secondsInput" class="input-field w-20 h-12 text-2xl font-bold border-2 border-orange-300 rounded-lg text-orange-800" 
                               value="0" min="0" max="59" placeholder="0">
                        <div class="text-orange-600 text-sm mt-1">×©× ×™×•×ª</div>
                    </div>
                </div>

                <!-- Cycles Selection -->
                <div class="flex justify-center items-center mb-4">
                    <label for="cyclesSelect" class="text-orange-700 ml-2">××—×–×•×¨×™ ×”×ª×¨××”:</label>
                    <select id="cyclesSelect" class="border-2 border-orange-300 rounded-lg p-2 text-orange-800">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="grid grid-cols-3 gap-3 mb-6">
            <button id="startBtn" class="control-button bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-xl shadow-lg">
                <i class="fas fa-play mr-1"></i> START
            </button>
            <button id="pauseBtn" class="control-button bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-xl shadow-lg" style="display: none;">
                <i class="fas fa-pause mr-1"></i> PAUSE
            </button>
            <button id="resumeBtn" class="control-button bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-xl shadow-lg" style="display: none;">
                <i class="fas fa-play mr-1"></i> RESUME
            </button>
            <button id="stopBtn" class="control-button bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-xl shadow-lg">
                <i class="fas fa-stop mr-1"></i> STOP
            </button>
        </div>

        <!-- Time Adjustment Buttons -->
        <div class="grid grid-cols-2 gap-3 mb-6">
            <button id="addMinuteBtn" class="control-button bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-xl shadow-lg">
                <i class="fas fa-plus mr-1"></i> +1 ×“×§'
            </button>
            <button id="subtractMinuteBtn" class="control-button bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-xl shadow-lg">
                <i class="fas fa-minus mr-1"></i> -1 ×“×§'
            </button>
        </div>

        <!-- Stop Alarm Button (Hidden by default) -->
        <div id="stopAlarmContainer" class="mb-6" style="display: none;">
            <button id="stopAlarmBtn" class="stop-alarm-button w-full text-white font-bold py-4 rounded-xl shadow-xl text-lg">
                <i class="fas fa-volume-mute mr-2"></i>
                ×¢×¦×•×¨ ×¦×¤×¦×•×£
            </button>
        </div>

        <!-- Quick Times -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
            <h3 class="text-lg font-semibold text-orange-800 mb-3 text-center">×–×× ×™× ××”×™×¨×™×</h3>
            <div class="grid grid-cols-2 gap-2" id="quickTimesGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            <button id="editTimesBtn" class="w-full mt-3 bg-orange-200 hover:bg-orange-300 text-orange-800 font-semibold py-2 rounded-lg transition-all">
                <i class="fas fa-edit mr-1"></i> ×¢×¨×™×›×ª ×–×× ×™×
            </button>
        </div>

        <!-- Footer -->
        <div class="text-center text-orange-600 text-sm">
            × ×•×¦×¨ ×‘××™×•×—×“ ×¢×‘×•×¨ ×‘×©×œ× ×™× ×©×¨×•×¦×™× ×œ×©×—×¨×¨ ××ª ××œ×§×¡×” ×œ×“×‘×¨×™× ××—×¨×™× ğŸ¤–ğŸ‘¨â€ğŸ³
        </div>
    </div>

    <!-- Edit Times Modal -->
    <div id="editModal" class="fixed inset-0 modal-overlay bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-orange-800">×¢×¨×™×›×ª ×–×× ×™× ××”×™×¨×™×</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div id="editForm" class="space-y-4">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div class="flex gap-3 mt-6">
                    <button id="saveBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded-lg">
                        ×©××™×¨×”
                    </button>
                    <button id="cancelBtn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg">
                        ×‘×™×˜×•×œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Install Instructions Modal -->
    <div id="installModal" class="fixed inset-0 modal-overlay bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-blue-800">×”×ª×§× ×ª ×”××¤×œ×™×§×¦×™×”</h3>
                    <button id="closeInstallModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4 text-right">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">ğŸ“± iPhone/iPad:</h4>
                        <p class="text-blue-700 text-sm">
                            1. ×¤×ª×— ×‘-Safari<br>
                            2. ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ "×©×ª×£" <i class="fas fa-share"></i><br>
                            3. ×‘×—×¨ "×”×•×¡×£ ×œ×¢××•×“ ×”×‘×™×ª"<br>
                            4. ×œ×—×¥ "×”×•×¡×£"
                        </p>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">ğŸ¤– Android:</h4>
                        <p class="text-green-700 text-sm">
                            1. ×¤×ª×— ×‘-Chrome<br>
                            2. ×œ×—×¥ ×¢×œ ×”×ª×¤×¨×™×˜ (â‹®)<br>
                            3. ×‘×—×¨ "×”×•×¡×£ ×œ×¢××•×“ ×”×‘×™×ª"<br>
                            4. ×œ×—×¥ "×”×•×¡×£"
                        </p>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">ğŸ’» ××—×©×‘:</h4>
                        <p class="text-purple-700 text-sm">
                            1. ×—×¤×© ××™×™×§×•×Ÿ ×”×ª×§× ×” ×‘×›×ª×•×‘×ª<br>
                            2. ×œ×—×¥ "×”×ª×§×Ÿ"<br>
                            3. ××©×¨ ×”×ª×§× ×”
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Default quick times
        let quickTimes = [
            { name: '×‘×™×¦×” ×¨×›×”', minutes: 3, seconds: 0 },
            { name: '×ª×”', minutes: 2, seconds: 0 },
            { name: '×§×¤×”', minutes: 5, seconds: 0 },
            { name: '×¤×¡×˜×”', minutes: 8, seconds: 0 },
            { name: '×¤×™×¦×”', minutes: 12, seconds: 0 },
            { name: '××•×¨×–', minutes: 15, seconds: 0 },
            { name: '×¢×•×£ ×‘×ª× ×•×¨', minutes: 25, seconds: 0 },
            { name: '×¢×•×’×”', minutes: 45, seconds: 0 }
        ];

        // Load saved quick times
        const savedTimes = localStorage.getItem('quickTimes');
        if (savedTimes) {
            quickTimes = JSON.parse(savedTimes);
        }

        // Timer state
        let timerInterval = null;
        let totalSeconds = 0;
        let isRunning = false;
        let isPaused = false;
        let alarmInterval = null;
        let currentCycle = 0;
        let maxCycles = 3;

        // DOM elements
        const timerDisplay = document.getElementById('timerDisplay');
        const minutesInput = document.getElementById('minutesInput');
        const secondsInput = document.getElementById('secondsInput');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const addMinuteBtn = document.getElementById('addMinuteBtn');
        const subtractMinuteBtn = document.getElementById('subtractMinuteBtn');
        const cyclesSelect = document.getElementById('cyclesSelect');
        const stopAlarmBtn = document.getElementById('stopAlarmBtn');
        const stopAlarmContainer = document.getElementById('stopAlarmContainer');
        const quickTimesGrid = document.getElementById('quickTimesGrid');
        const editTimesBtn = document.getElementById('editTimesBtn');
        const editModal = document.getElementById('editModal');
        const installBtn = document.getElementById('installBtn');
        const installModal = document.getElementById('installModal');

        // Audio context for beeps
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep(frequency = 1000, duration = 200) {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            timerDisplay.textContent = formatTime(totalSeconds);
        }

        function updateInputs() {
            minutesInput.value = Math.floor(totalSeconds / 60);
            secondsInput.value = totalSeconds % 60;
        }

        function getInputTime() {
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            return minutes * 60 + (seconds > 59 ? 59 : seconds);
        }

        function startTimer() {
            if (!isRunning && !isPaused) {
                totalSeconds = getInputTime();
                if (totalSeconds === 0) return;
            }
            
            isRunning = true;
            isPaused = false;
            maxCycles = parseInt(cyclesSelect.value);
            
            startBtn.style.display = 'none';
            pauseBtn.style.display = 'block';
            resumeBtn.style.display = 'none';
            
            timerDisplay.classList.add('timer-running');
            
            timerInterval = setInterval(() => {
                if (totalSeconds > 0) {
                    totalSeconds--;
                    updateDisplay();
                    updateInputs();
                } else {
                    stopTimer();
                    startAlarm();
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            isPaused = true;
            clearInterval(timerInterval);
            
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'block';
            
            timerDisplay.classList.remove('timer-running');
            playBeep(800, 100);
        }

        function resumeTimer() {
            startTimer();
            playBeep(1000, 100);
            playBeep(1200, 100);
        }

        function stopTimer() {
            isRunning = false;
            isPaused = false;
            clearInterval(timerInterval);
            
            startBtn.style.display = 'block';
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'none';
            
            timerDisplay.classList.remove('timer-running');
        }

        function resetTimer() {
            stopTimer();
            totalSeconds = 0;
            updateDisplay();
            updateInputs();
        }

        function addMinute() {
            if (isRunning || isPaused) {
                totalSeconds += 60;
                updateDisplay();
                updateInputs();
                playBeep(1200, 150);
            }
        }

        function subtractMinute() {
            if (isRunning || isPaused) {
                totalSeconds = Math.max(0, totalSeconds - 60);
                updateDisplay();
                updateInputs();
                playBeep(800, 150);
            }
        }

        function startAlarm() {
            currentCycle = 0;
            stopAlarmContainer.style.display = 'block';
            document.body.classList.add('beep');
            
            const beepSequence = () => {
                if (currentCycle >= maxCycles) {
                    stopAlarm();
                    return;
                }
                
                let beepCount = 0;
                const beepInterval = setInterval(() => {
                    if (beepCount < 3) {
                        const frequencies = [1000, 1200, 1400];
                        playBeep(frequencies[beepCount], 300);
                        beepCount++;
                    } else {
                        clearInterval(beepInterval);
                        currentCycle++;
                        
                        if (currentCycle < maxCycles) {
                            setTimeout(beepSequence, 2000);
                        } else {
                            stopAlarm();
                        }
                    }
                }, 400);
            };
            
            beepSequence();
            
            // Browser notification
            if (Notification.permission === 'granted') {
                new Notification('×”×¢×•×–×¨×ª ×©×œ ××œ×§×¡×”', {
                    body: '×”×˜×™×™××¨ ×”×¡×ª×™×™×! ×”×–××Ÿ ×œ×‘×“×•×§ ××ª ×”×‘×™×©×•×œ ğŸ³',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iMTAwIiB5PSIxMDAiIHdpZHRoPSIzMTIiIGhlaWdodD0iMzEyIiBmaWxsPSIjZGdjaGgiIHJ4PSIxOCIvPjwvc3ZnPg=='
                });
            }
        }

        function stopAlarm() {
            clearInterval(alarmInterval);
            stopAlarmContainer.style.display = 'none';
            document.body.classList.remove('beep');
            currentCycle = 0;
        }

        function renderQuickTimes() {
            quickTimesGrid.innerHTML = '';
            quickTimes.forEach((time, index) => {
                const button = document.createElement('button');
                button.className = 'preset-button text-white font-semibold py-2 px-3 rounded-lg shadow-lg text-sm';
                button.innerHTML = `
                    <div class="text-xs opacity-90">${time.name}</div>
                    <div class="font-bold">${time.minutes}:${time.seconds.toString().padStart(2, '0')}</div>
                `;
                button.addEventListener('click', () => {
                    minutesInput.value = time.minutes;
                    secondsInput.value = time.seconds;
                    totalSeconds = time.minutes * 60 + time.seconds;
                    updateDisplay();
                });
                quickTimesGrid.appendChild(button);
            });
        }

        function showEditModal() {
            const editForm = document.getElementById('editForm');
            editForm.innerHTML = '';
            
            quickTimes.forEach((time, index) => {
                const div = document.createElement('div');
                div.className = 'bg-orange-50 p-3 rounded-lg';
                div.innerHTML = `
                    <div class="grid grid-cols-3 gap-2 items-center">
                        <input type="text" id="name${index}" value="${time.name}" class="border rounded p-2 text-sm" placeholder="×©× ×”×× ×”">
                        <input type="number" id="minutes${index}" value="${time.minutes}" min="0" max="99" class="border rounded p-2 text-sm" placeholder="×“×§'">
                        <input type="number" id="seconds${index}" value="${time.seconds}" min="0" max="59" class="border rounded p-2 text-sm" placeholder="×©× '">
                    </div>
                `;
                editForm.appendChild(div);
            });
            
            editModal.classList.remove('hidden');
        }

        function saveQuickTimes() {
            quickTimes.forEach((time, index) => {
                const nameInput = document.getElementById(`name${index}`);
                const minutesInput = document.getElementById(`minutes${index}`);
                const secondsInput = document.getElementById(`seconds${index}`);
                
                if (nameInput && minutesInput && secondsInput) {
                    time.name = nameInput.value || time.name;
                    time.minutes = parseInt(minutesInput.value) || 0;
                    time.seconds = Math.min(parseInt(secondsInput.value) || 0, 59);
                }
            });
            
            localStorage.setItem('quickTimes', JSON.stringify(quickTimes));
            renderQuickTimes();
            editModal.classList.add('hidden');
        }

        function showInstallModal() {
            installModal.classList.remove('hidden');
        }

        // Event listeners
        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resumeBtn.addEventListener('click', resumeTimer);
        stopBtn.addEventListener('click', resetTimer);
        addMinuteBtn.addEventListener('click', addMinute);
        subtractMinuteBtn.addEventListener('click', subtractMinute);
        stopAlarmBtn.addEventListener('click', stopAlarm);
        editTimesBtn.addEventListener('click', showEditModal);
        installBtn.addEventListener('click', showInstallModal);

        // Modal close events
        document.getElementById('closeModal').addEventListener('click', () => {
            editModal.classList.add('hidden');
        });

        document.getElementById('closeInstallModal').addEventListener('click', () => {
            installModal.classList.add('hidden');
        });

        document.getElementById('saveBtn').addEventListener('click', saveQuickTimes);
        document.getElementById('cancelBtn').addEventListener('click', () => {
            editModal.classList.add('hidden');
        });

        // Input validation
        secondsInput.addEventListener('input', () => {
            let value = parseInt(secondsInput.value);
            if (value > 59) {
                secondsInput.value = 59;
            } else if (value < 0) {
                secondsInput.value = 0;
            }
        });

        minutesInput.addEventListener('input', () => {
            let value = parseInt(minutesInput.value);
            if (value < 0) {
                minutesInput.value = 0;
            }
        });

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // PWA Install detection
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            } else {
                showInstallModal();
            }
        });

        // Initialize
        renderQuickTimes();
        updateDisplay();
        
        // Enable audio on first user interaction
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('touchstart', initAudio, { once: true });
    </script>
</body>
</html>
